2020年5月24日 15:29:23

# 1. 主从复制双机热备

## 1.1 主从复制

### 1.1.1 主从复制原理

mysql数据库提供了一种主从备份的机制，其实就是把主数据库的所有的数据同时写到备份的数据库中。实现mysql数据库的热备份。

要想实现双机的热备，首先要了解主从数据库服务器的版本的需求。从数据库的数据版本可以高于主服务器数据库的版本，但是不可以低于主服务器的数据库版本。

### 1.1.2 主从复杂过程

![img](C:\code\github\java-interview\img\mysql-1.png)

主从复制一共分为三步：（只有日志而不是真实数据）

- master将改变记录到二进制日志（binary log）。这些记录过程叫做二进制日志事件，binary log events。 
- slave将master的binary log events拷贝到它的中继日志（relay log）。
- slave重做中继日志中的事件，将改变应用到自己的数据库中。 MySQL复制是异步的且串行化的。

由于主从复制的一些特性，为了保证数据一致，所以这里有些原则需要遵守：

- 每个slave只有一个master
- 每个slave只能有一个唯一的服务器ID
- 每个master可以有多个slave

## 1.2 主从复杂实战

# 2. 双机热备

## 2.1 双机热备原理

实现双机热备，原理其实就是做两个机器的互相主从，我们把上述步骤主从对调，然后做一遍就能实现了双机热备了。

![img](C:\code\github\java-interview\img\mysql-2.png)

## 2.2 双机热备原理

由于两台机器互为主从，当同时插入数据时，对自增的ID会出错。

要么使用非自增 UUID，但是会导致存储性能下降，产生碎片和分页过多，树深度过多等问题。

要么一台主机增加奇数键，另一台主机增加偶数键。