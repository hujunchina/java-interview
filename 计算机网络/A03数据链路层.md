2020年5月19日 15:32:10

### 目录

1. 概述
2. 点对点信道
3. 广播信道
4. 扩展以太网
5. 高速以太网



### 1. 概述

数据链路层属于通信模型底层第二层，主要是承接网络层IP数据分组的封装，及对物理层的二进制流拆封转换。

可大致分为点对点信道类型（使用 PPP 协议）和广播信道类型（使用 CSMA/CD 协议）。广播信道是多个主机共用一个共享信道通信，比较复杂。

该层解决三个问题：封装成帧、透明传输、差错检测。

该层包含硬件设备：网络适配器、转换器、集线器、网桥、以太网交换机等。

![image-20200520151122499](C:\code\github\java-interview\img\internet-13.png)

### 2. 点对点信道

#### 2.1 数据链路和帧定义

链路(link)是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。

数据链路(data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

一般使用适配器（即网卡）来实现这些协议的硬件和软件，其包含物理层和数据链路层。

同时数据链路层传输的载体数据叫帧。

![image-20200520151502507](C:\code\github\java-interview\img\internet-14.png)

#### 2.2 如何解决三个问题

##### 2.2.1 封装成帧

封装成帧(framing)就是在一段数据（IP数据报）的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。首部和尾部的一个重要作用就是进行帧定界。

![image-20200520151850274](C:\code\github\java-interview\img\internet-15.png)

- 帧首部用SOH（start of header）0x01表示
- 帧尾部用EOT（end of tail）0x04表示

这里封装的帧很简单，因为是点对点传输，每个通道都是固定已知的发送者和接受者，所以不用封装地址等其他信息，只需要加入首尾即可。

##### 2.2.2 透明传输

透明传输即要保证可以传输任何字段而不需要考虑是否与关键字冲突。比如可以传输SOH和EOT。

为了解决这个问题，可以使用字节填充或字符填充方式（插入转义字符）。

如果转义字符也出现了，那就在前面再加一个转义字符。

![image-20200520152628731](C:\code\github\java-interview\img\internet-16.png)

##### 2.2.3 差错控制

传输过程中，受到干扰，比特位会变为0或1，发生比特差错。

误码率（传输错误的比特占所传输比特总数的比率）。

循环冗余检验 CRC，在发送端，先把数据划分为组。假定每组 *k* 个比特。假设待传送的一组数据 *M* = 101001（现在 *k* = 6）。我们在 *M* 的后面再添加供差错检测用的 *n* 位冗余码一起发送。 

在数据后面添加上的冗余码称为帧检验序列 FCS (Frame Check Sequence)。

仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)，要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。 

#### 2.3 点对点协议 PPP

用户使用拨号电话线接入因特网时，一般都是使用 PPP 协议。 

三部分组成：

- 一个将 IP 数据报封装到串行链路的方法
- 链路控制协议 LCP (Link Control Protocol)
- 网络控制协议 NCP (Network Control Protocol)

PPP 协议的帧格式：

- 标志字段 F = 0x7E （符号“0x”表示后面的字符是用十六进制表示。十六进制的 7E 的二进制表示是 01111110）
- 地址字段 A 只置为 0xFF。地址字段实际上并不起作用
- 控制字段 C 通常置为 0x03
- PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节

![image-20200520153406570](C:\code\github\java-interview\img\internet-17.png)

字符填充（异步传输）：

- 将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列(0x7D, 0x5E)
- 若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列(0x7D, 0x5D)
- 若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变

零比特填充（同步传输，不需要考虑位同步）：

- 在发送端，只要发现有 5 个连续 1，则立即填入一个 0。
- 接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除

![image-20200520153856054](C:\code\github\java-interview\img\internet-18.png)

### 3. 广播信道

#### 3.1 局域网的数据链路层

##### 3.1.1 共享通道的两种方式

- 静态划分信道（频分、时分、波分、码分）
- 动态媒体接入控制（多点接入）（随机接入，受控接入）

##### 3.1.2 以太网标准

- DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约
- IEEE 的 802.3 标准

#### 3.2 适配器

网络接口板又称为通信适配器(adapter)或网络接口卡 NIC (Network Interface Card)，或“网卡”。

##### 3.2.1 适配器的重要功能：

- n进行串行/并行转换。
- n对数据进行缓存。
- n在计算机的操作系统安装设备驱动程序。
- n实现以太网协议。 

![image-20200520160121654](C:\code\github\java-interview\img\i)

#### 3.3 CSMA/CD 协议 

物理层需采用差分曼彻斯特编码，CSMA/CD 表示 Carrier Sense Multiple Access with Collision Detection

“多点接入”表示许多计算机以多点接入的方式连接在一根总线上

“载波监听”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞

#### 3.4 以太网

##### 3.4.1 MAC 层

在局域网中，硬件地址又称为物理地址，或 MAC 地址 。

802 标准所说的“地址”严格地讲应当是每一个站的“名字”或标识符，一个地址块可以生成224个不同的地址。这种 48 位地址称为 MAC-48，它的通用名称是EUI-48。

“MAC地址”实际上就是适配器地址或适配器标识符EUI-48。

##### 3.4.2 适配器检查 MAC 地址

适配器从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址，如果是发往本站的帧则收下，然后再进行其他的处理，否则就将此帧丢弃，不再进行其他的处理。

##### 3.4.3 MAC 帧的格式 

![image-20200520163006240](C:\code\github\java-interview\img\internet-20.png)

同步码是为了发送端向接收端对码用的，告诉接收端下面就是数据了，请接收。

### 4. 扩展以太网

#### 4.1 使用集线器（物理层）

优点：

- 使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域的通信。

- 扩大了局域网覆盖的地理范围。

缺点：

- 碰撞域增大了，但总的吞吐量并未提高。

- 如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。  

#### 4.2 使用网桥（数据链路层）

网桥工作在数据链路层，它根据 MAC 帧的目的地址对收到的帧进行转发。

网桥具有过滤帧的功能。当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口。

![image-20200520163825085](C:\code\github\java-interview\img\internet-21.png)

使用hyperV时候，需要搭建网络，当设置外部网络时，会在虚拟机和真实网络主机之间建立一个网桥。

主机是一个碰撞域（192.168.124.7），虚拟机是另一个碰撞域（124.168.173.2）

网桥在转发帧之前必须执行 CSMA/CD 算法，若在发送过程中出现碰撞，就必须停止发送和进行退避。

#### 4.3 以太网交换机（数据链路层）

交换式集线器常称为以太网交换机(switch)或第二层交换机（表明此交换机工作在数据链路层）。

以太网交换机通常都有十几个接口。因此，以太网交换机实质上就是一个多接口的网桥，可见交换机工作在数据链路层。

以太网交换机的每个接口都直接与主机相连，并且一般都工作在全双工方式。

交换机能同时连通许多对的接口，使每一对相互通信的主机都能像独占通信媒体那样，进行无碰撞地传输数据。

以太网交换机由于使用了专用的交换结构芯片，其交换速率就较高。



### 5. 高速以太网